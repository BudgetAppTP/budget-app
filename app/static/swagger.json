{
  "openapi": "3.0.0",
  "info": {
    "title": "API Dokumentácia – Príjmy a Výdavky",
    "version": "1.0.0",
    "description": "Rozhranie pre prácu s príjmami (Incomes) a výdavkami (Receipts & Receipt Items)."
  },
  "servers": [
    { "url": "/" }
  ],
  "paths": {
    "/api/users": {
      "get": {
        "summary": "Získanie zoznamu používateľov",
        "responses": {
          "200": {
            "description": "Úspešne načítaní používatelia",
            "content": {
              "application/json": {
                "example": [
                  {
                    "id": "78754f0f-e6ed-4a10-a09a-26da4cb2a5f6",
                    "username": "anton",
                    "email": "anton@example.com",
                    "created_at": "2025-10-27T15:30:00Z"
                  }
                ]
              }
            }
          }
        }
      },
      "post": {
        "summary": "Vytvorenie nového používateľa",
        "description": "Vytvorí nového používateľa systému.\n\n**Povinné polia:** `username`, `email`, `password_hash`\n\n**Nepovinné polia:** žiadne (všetky ostatné sú generované automaticky – `id`, `created_at`).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "example": {
                "username": "anton",
                "email": "anton@example.com",
                "password_hash": "pbkdf2:sha256:260000$..."
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Používateľ úspešne vytvorený",
            "content": {
              "application/json": {
                "example": {
                  "id": "78754f0f-e6ed-4a10-a09a-26da4cb2a5f6",
                  "message": "User created successfully"
                }
              }
            }
          },
          "400": {
            "description": "Neplatné dáta – chýbajú povinné polia",
            "content": {
              "application/json": {
                "example": { "error": "Missing required fields" }
              }
            }
          }
        }
      }
    },

    "/api/receipts": {
      "get": {
        "summary": "Získanie zoznamu všetkých účteniek",
        "responses": {
          "200": {
            "description": "Úspešne načítané účtenky",
            "content": {
              "application/json": {
                "example": [
                  {
                    "id": "c0e4f248-f14d-4f53-b92c-9f5ecb8239d4",
                    "external_uid": "INV-2025-00012",
                    "merchant": "Lidl - potraviny",
                    "issue_date": "2025-10-27",
                    "currency": "EUR",
                    "total_amount": 45.20,
                    "extra_metadata": { "payment_method": "card", "vat": 7.5 },
                    "user_id": "78754f0f-e6ed-4a10-a09a-26da4cb2a5f6",
                    "created_at": "2025-10-27T19:00:00Z"
                  }
                ]
              }
            }
          }
        }
      },
      "post": {
        "summary": "Vytvorenie novej účtenky",
        "description": "Vytvorí novú účtenku (receipt) priradenú k existujúcemu používateľovi.\n\n**Povinné polia:** `user_id`, `merchant`, `issue_date`, `total_amount`\n\n**Nepovinné polia:** `currency` (predvolené `EUR`), `external_uid`, `extra_metadata` (Ľubovoľné JSON údaje, napr. DPH, spôsob platby).",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "example": {
                "user_id": "78754f0f-e6ed-4a10-a09a-26da4cb2a5f6",
                "merchant": "Lidl - potraviny",
                "issue_date": "2025-10-27",
                "currency": "EUR",
                "total_amount": 45.20,
                "external_uid": "INV-2025-00012",
                "extra_metadata": {
                  "payment_method": "card",
                  "vat": 7.5,
                  "cashier": "Marek",
                  "location": "Bratislava"
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Úspešne vytvorená účtenka",
            "content": {
              "application/json": {
                "example": {
                  "id": "c0e4f248-f14d-4f53-b92c-9f5ecb8239d4",
                  "message": "Receipt created successfully"
                }
              }
            }
          },
          "400": {
            "description": "Chybná požiadavka – chýbajú povinné polia alebo zlé formáty dát",
            "content": {
              "application/json": {
                "example": { "error": "Missing required fields" }
              }
            }
          }
        }
      }
    },
    "/api/receipts/{receipt_id}": {
      "get": {
        "summary": "Získanie detailu účtenky podľa ID",
        "parameters": [
          {
            "in": "path",
            "name": "receipt_id",
            "required": true,
            "schema": { "type": "string", "format": "uuid" },
            "description": "UUID účtenky"
          }
        ],
        "responses": {
          "200": {
            "description": "Úspešne načítaná účtenka",
            "content": {
              "application/json": {
                "example": {
                  "id": "c0e4f248-f14d-4f53-b92c-9f5ecb8239d4",
                  "external_uid": "INV-2025-00012",
                  "merchant": "Lidl - potraviny",
                  "issue_date": "2025-10-27",
                  "currency": "EUR",
                  "total_amount": 45.20,
                  "extra_metadata": { "payment_method": "card", "vat": 7.5 },
                  "user_id": "78754f0f-e6ed-4a10-a09a-26da4cb2a5f6",
                  "created_at": "2025-10-27T19:00:00Z"
                }
              }
            }
          },
          "404": {
            "description": "Účtenka nebola nájdená",
            "content": {
              "application/json": { "example": { "error": "Receipt not found" } }
            }
          }
        }
      },
      "put": {
        "summary": "Aktualizácia existujúcej účtenky",
        "description": "Aktualizuje záznam účtenky podľa ID.\n\n**Nepovinné polia:** `merchant`, `issue_date`, `currency`, `total_amount`, `external_uid`, `extra_metadata`.",
        "parameters": [
          {
            "in": "path",
            "name": "receipt_id",
            "required": true,
            "schema": { "type": "string", "format": "uuid" }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "example": {
                "merchant": "Tesco - týždenný nákup",
                "issue_date": "2025-10-29",
                "currency": "EUR",
                "total_amount": 60.50,
                "extra_metadata": {
                  "payment_method": "cash",
                  "vat": 9.5,
                  "cashier": "Mária"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Úspešne aktualizovaná účtenka",
            "content": {
              "application/json": {
                "example": {
                  "id": "c0e4f248-f14d-4f53-b92c-9f5ecb8239d4",
                  "message": "Receipt updated successfully"
                }
              }
            }
          },
          "400": {
            "description": "Neplatné dáta alebo formát dátumu",
            "content": {
              "application/json": {
                "example": { "error": "Invalid date format" }
              }
            }
          },
          "404": {
            "description": "Účtenka nebola nájdená",
            "content": {
              "application/json": { "example": { "error": "Receipt not found" } }
            }
          }
        }
      },
      "delete": {
        "summary": "Odstránenie účtenky podľa ID",
        "parameters": [
          {
            "in": "path",
            "name": "receipt_id",
            "required": true,
            "schema": { "type": "string", "format": "uuid" }
          }
        ],
        "responses": {
          "200": {
            "description": "Účtenka bola úspešne odstránená",
            "content": {
              "application/json": {
                "example": { "message": "Receipt deleted successfully" }
              }
            }
          },
          "404": {
            "description": "Účtenka nebola nájdená",
            "content": {
              "application/json": { "example": { "error": "Receipt not found" } }
            }
          }
        }
      }
    }
    ,
    "/api/receipts/{receipt_id}/items": {
      "get": {
        "summary": "Získanie položiek výdavku",
        "parameters": [
          {
            "in": "path",
            "name": "receipt_id",
            "required": true,
            "schema": { "type": "integer" }
          }
        ],
        "responses": {
          "200": {
            "description": "Úspešne načítané položky",
            "content": {
              "application/json": {
                "example": [
                  { "item_id": 1, "name": "Mlieko", "quantity": 2, "unit_price": 1.2 },
                  { "item_id": 2, "name": "Chlieb", "quantity": 1, "unit_price": 1.5 }
                ]
              }
            }
          }
        }
      },
      "post": {
        "summary": "Vytvorenie položky pre výdavok",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "example": {
                "category_id": 4,
                "name": "Banány",
                "quantity": 3,
                "unit_price": 0.9
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Položka úspešne pridaná",
            "content": {
              "application/json": {
                "example": { "item_id": 23 }
              }
            }
          }
        }
      }
    },
    "/api/receipts/{receipt_id}/items/{item_id}": {
      "put": {
        "summary": "Aktualizácia položky",
        "parameters": [
          { "in": "path", "name": "receipt_id", "required": true, "schema": { "type": "integer" } },
          { "in": "path", "name": "item_id", "required": true, "schema": { "type": "integer" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "example": {
                "name": "Maslo",
                "quantity": 1,
                "unit_price": 2.3
              }
            }
          }
        },
        "responses": { "200": { "description": "Úspešne aktualizované" } }
      },
      "delete": {
        "summary": "Odstránenie položky",
        "responses": { "200": { "description": "Položka úspešne vymazaná" } }
      }
    },
        "/api/incomes/": {
      "get": {
        "summary": "Získanie zoznamu všetkých príjmov",
        "description": "Vráti zoznam všetkých príjmov vrátane celkovej sumy. Možno použiť voliteľné parametre na triedenie podľa dátumu alebo sumy.",
        "parameters": [
          {
            "in": "query",
            "name": "sort_by",
            "schema": { "type": "string", "enum": ["date", "amount"], "default": "date" },
            "description": "Triedenie podľa poľa (date alebo amount)"
          },
          {
            "in": "query",
            "name": "order",
            "schema": { "type": "string", "enum": ["asc", "desc"], "default": "asc" },
            "description": "Poradie triedenia – vzostupne alebo zostupne"
          }
        ],
        "responses": {
          "200": {
            "description": "Úspešne načítané",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "incomes": [
                    { "id": 1, "date": "2025-10-01", "description": "Výplata", "amount": 1200.00 },
                    { "id": 2, "date": "2025-10-05", "description": "Darček od babky", "amount": 200.00 }
                  ],
                  "total_amount": 1400.00
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Vytvorenie nového príjmu",
        "description": "Pridá nový záznam o príjme s dátumom, popisom a sumou.",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "example": {
                "date": "2025-10-15",
                "description": "Freelance projekt",
                "amount": 500.00
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Úspešne vytvorený príjem",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "income": {
                    "id": 4,
                    "date": "2025-10-15",
                    "description": "Freelance projekt",
                    "amount": 500.00
                  }
                }
              }
            }
          },
          "400": {
            "description": "Neplatné vstupné dáta",
            "content": {
              "application/json": {
                "example": { "success": false, "error": "Invalid input data" }
              }
            }
          }
        }
      }
    },
    "/api/incomes/{item_id}": {
      "put": {
        "summary": "Aktualizácia existujúceho príjmu",
        "parameters": [
          {
            "in": "path",
            "name": "item_id",
            "required": true,
            "schema": { "type": "integer" },
            "description": "ID príjmu, ktorý sa má aktualizovať"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "example": {
                "date": "2025-10-16",
                "description": "Zmenený popis",
                "amount": 600.00
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Úspešne aktualizované",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "income": {
                    "id": 2,
                    "date": "2025-10-16",
                    "description": "Zmenený popis",
                    "amount": 600.00
                  }
                }
              }
            }
          },
          "404": {
            "description": "Príjem nebol nájdený",
            "content": {
              "application/json": {
                "example": { "success": false, "error": "Income not found" }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Odstránenie existujúceho príjmu",
        "parameters": [
          {
            "in": "path",
            "name": "item_id",
            "required": true,
            "schema": { "type": "integer" },
            "description": "ID príjmu, ktorý sa má odstrániť"
          }
        ],
        "responses": {
          "200": {
            "description": "Úspešne odstránené",
            "content": {
              "application/json": {
                "example": {
                  "success": true,
                  "incomes": [
                    { "id": 1, "date": "2025-10-01", "description": "Výplata", "amount": 1200.00 },
                    { "id": 3, "date": "2025-10-10", "description": "Predaj starého bicykla", "amount": 350.00 }
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Príjem nebol nájdený",
            "content": {
              "application/json": {
                "example": { "success": false, "error": "Income not found" }
              }
            }
          }
        }
      }
    }
  }
}
