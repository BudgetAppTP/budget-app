<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BudgetApp ¬∑ Rozpoƒçet</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style_list.css') }}">

</head>
<body>
{% block head_extra %}
{% endblock %}

{% block content %}
        {% include "navbar.html" %}
    <div class="wrap">
  <div class="page-header">
    <div class="month-nav">
      <button id="prev-month">‚óÄ</button>
      <h2>{{ month }}</h2>
      <button id="next-month">‚ñ∂</button>
    </div>

    <div class="export-btns">
      <a class="btn" href="{{ url_for('export.pdf') }}?month={{ month_key }}">Export to PDF</a>
      <a class="btn" href="{{ url_for('export.csv') }}?month={{ month_key }}">Export to CSV</a>
    </div>
  </div>

  <div class="section-title">Pr√≠jmy a V√Ωdavky</div>

  <div class="tables">
    <div class="table-box">
      <div class="table-header">
        <h3>üìä Pr√≠jmy</h3>
        <a class="btn" href="{{ url_for('transactions.income_list') }}">+ Prida≈• pr√≠jem</a>
      </div>
      <table>
        <thead>
        <tr><th>D√°tum</th><th>Popis</th><th>Suma (‚Ç¨)</th></tr>
        </thead>
        <tbody>
        {% for i in incomes %}
        <tr>
          <td>{{ i.date }}</td>
          <td>{{ i.description }}</td>
          <td class="amount">+ {{ "%.2f"|format(i.amount) }}</td>
        </tr>
        {% endfor %}
        </tbody>
        <tfoot>
        <tr>
          <td colspan="2"><strong>Spolu pr√≠jmy</strong></td>
          <td class="amount"><strong>{{ "%.2f"|format(total_income) }}</strong></td>
        </tr>
        </tfoot>
      </table>
    </div>

    <div class="table-box">
      <div class="table-header">
        <h3>üí∏ V√Ωdavky</h3>
        <a class="btn" href="{{ url_for('transactions.new_expense') }}">+ Prida≈• v√Ωdavok</a>
      </div>
      <table>
        <thead>
        <tr><th>Suma (‚Ç¨)</th><th>D√°tum</th><th>Kateg√≥ria</th></tr>
        </thead>
        <tbody>
        {% for e in expenses %}
        <tr>
          <td class="amount">- {{ "%.2f"|format(e.amount) }}</td>
          <td>{{ e.date }}</td>
          <td>{{ e.category }}</td>
        </tr>
        {% endfor %}
        </tbody>
        <tfoot>
        <tr>
          <td class="amount"><strong>-{{ "%.2f"|format(total_expense) }}</strong></td>
          <td colspan="2"><strong>Spolu v√Ωdavky</strong></td>
        </tr>
        </tfoot>
      </table>
    </div>
  </div>

  <div class="balance-box">
    Zostatok: <strong id="main-balance">{{ "%.2f"|format(balance) }}</strong> ‚Ç¨
  </div>

  <div class="section-title">üìã Pl√°novanie rozpoƒçtu</div>

  <div class="plan-box">
    <div class="plan-header">
      <h3>Zostatok: <strong id="plan-balance">{{ "%.2f"|format(balance) }} ‚Ç¨</strong></h3>
      <button class="btn" type="button">+ Prida≈• kateg√≥riu</button>
    </div>

    <table id="plan-table">
      <thead>
      <tr><th>Kateg√≥ria</th><th>Percento</th><th>ƒåiastka (‚Ç¨)</th></tr>
      </thead>
      <tbody>
      {% for p in planning %}
      <tr>
        <td>{{ p.category }}</td>
        <td>
          <input type="number" class="percent-input" value="{{ p.percent }}" min="0" max="100" step="1"> %
        </td>
        <td class="amount plan-amount">{{ "%.2f"|format(balance * p.percent / 100) }}</td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
  document.querySelectorAll('.percent-input').forEach(input => {
    input.addEventListener('input', () => {
      const balance = parseFloat(document.getElementById('main-balance').textContent);
      const percent = parseFloat(input.value) || 0;
      const amount = (balance * percent / 100).toFixed(2);
      input.closest('tr').querySelector('.plan-amount').textContent = amount;
    });
  });

  document.addEventListener("DOMContentLoaded", () => {

        const today = new Date();
  const dateBadge = document.getElementById('dateBadge');

  if (dateBadge) {
    dateBadge.innerHTML = `
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none"
           xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <path d="M7 2v3M17 2v3M3.5 9.5h17M4 6.5h16a1.5 1.5 0 0 1 1.5 1.5v11A1.5 1.5 0 0 1 20 20.5H4A1.5 1.5 0 0 1 2.5 19V8A1.5 1.5 0 0 1 4 6.5Z"
              stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      </svg>
      <span>${today.toLocaleDateString('sk-SK', {
        year: 'numeric',
        month: 'long',
        day: '2-digit'
      })}</span>
    `;
  }



    const prev = document.getElementById("prev-month");
    const next = document.getElementById("next-month");

    prev.addEventListener("click", () => {
      window.location.href = `?month={{ prev_month }}`;
    });

    next.addEventListener("click", () => {
      window.location.href = `?month={{ next_month }}`;
    });

    const balance = {{ balance|tojson }};
    const inputs = document.querySelectorAll("#planning-table input");

    inputs.forEach(input => {
      input.addEventListener("input", () => {
        const tr = input.closest("tr");
        const amountTd = tr.querySelector(".auto-amount");
        const percent = parseFloat(input.value) || 0;
        const amount = (balance * percent / 100).toFixed(2);
        amountTd.textContent = amount;
      });
    });
  });
</script>
{% endblock %}
</body>